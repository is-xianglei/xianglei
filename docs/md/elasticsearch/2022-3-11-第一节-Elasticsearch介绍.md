# 第一节：了解Elasticsearch

作者：伊邪那岐
<br/>博客：[http://blog.xiangll.cn](http://blog.xiangll.cn)
<br/>原文：[http://blog.xiangll.cn](http://blog.xiangll.cn)


> 随手记录，防止遗忘📝，并非教程。



## 简介

### 通俗点理解,ES可以解释为

1. 实时文档存储，每个字段都可以被索引与搜索
2. 对全文搜索引擎库 [Apache Lucene](https://lucene.apache.org/core/) 的一个封装
3. ES底层检索数据结构也就是一个倒排索引

> Elasticsearch引擎把文档数据写入到倒排索引的数据结构中，倒排索引建立的是**分词**和**文档**之间的映射关系，在倒排索引中，数据是面向**词**而不是面向**文档**的. 
>
> 一个倒排索引由文档中所有**不重复词的列表**构成，对于其中每个词，有一个包含它的**文档列表**下面举例说明

### 对以下三个文档构造倒排索引

> 倒排前的结构

| 文档ID |                文档内容                 |
| :----: | :-------------------------------------: |
|   1    | elasticsearch是基于lucene的一款搜索引擎 |
|   2    |        elasticsearch是Java编写的        |
|   3    |          搜索引擎是如何诞生的           |

> 倒排后的结构

|      词       | 文档ID |
| :-----------: | :----: |
| elasticsearch |  1,2   |
|    lucene     |   1    |
|     java      |   2    |
|   搜索引擎    |  1,3   |
|     诞生      |   3    |
|     编写      |   2    |
|     如何      |   3    |
|     基于      |   1    |

> 补充一下: 
>
> 1. 仔细观察上面倒排前与倒排后表格的数据的规律和变化
> 2. mysql的查询,我们平时都是根据ID找到数据,而在es中我们是根据数据(词)找到文档ID

### 倒排索引查询过程

1. 查询包含`elasticsearch`的文档
2. 通过倒排索引获得`elasticsearch`相关的文档ID有1,2
3. 通过正排索引查询1,2的完整内容
4. 返回最终结果

### 倒排索引-组成

1. 单词词典

   * 单词词典的实现一般用B+数(这一块还需要在查阅资料学习补充一下)

2. 倒排列表

   * 文档id用于获取原始信息
   * 单词频率，记录该单词在该文档中出现的次数，用于后续相关性算分
   * 位置，记录单词在文档中的分词位置（多个），用于做词语搜索
   * 偏移，记录单词在文档的开始和结束位置，用于高亮显示

3. B+树内部结点存索引，叶子结点存数据，这里的 单词词典就是B+树索引，倒排列表就是数据.

4. ES存储的是一个JSON格式的文档，其中包含多个字段，每个字段会有自己的倒排索引



> 倒排索引这块我目前也是比较模糊不清,需要恶补,先把大概能理解的写出来.

